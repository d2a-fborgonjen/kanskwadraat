{{ header|raw }}

<div class="coachview-search">
    <!-- Search Bar -->
    <div class="coachview-search__bar">
        <input type="text" class="coachview-search__input" placeholder="Search productsâ€¦">
    </div>

    <!-- Main Content -->
    <div class="coachview-search__content">
        <!-- Sidebar -->
        <aside class="coachview-search__sidebar">
            <h3 class="coachview-search__sidebar-title">Categories</h3>
            {{ category_list|raw }}
        </aside>

        <!-- Results Area -->
        <section class="coachview-search__results">
            <div class="coachview-search__spinner"></div>
        </section>
    </div>
</div>

<script>
    const results = document.querySelector('.coachview-search__results');
    const spinner = document.querySelector('.coachview-search__spinner');
    const search = document.querySelector('.coachview-search__input');
    const checkboxes = document.querySelectorAll('.coachview-search__category-label input');

    function fetchProducts() {
        spinner.style.display = 'block';
        const categories = [...checkboxes].filter(c => c.checked).map(c => c.value);
        const data = new FormData();
        data.append('action', 'filter_products');
        data.append('search', search.value);
        categories.forEach(c => data.append('categories[]', c));

        fetch('{{ ajax_url }}', {
            method: 'POST',
            body: data
        })
            .then(res => res.text())
            .then(html => {
                results.innerHTML = '<div class="coachview-search__spinner"></div>' + html;
                spinner.style.display = 'none';
            });
    }

    search.addEventListener('input', fetchProducts);
    checkboxes.forEach(c => c.addEventListener('change', fetchProducts));
    fetchProducts();
</script>

{{ footer|raw }}
